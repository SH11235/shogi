# 将棋Webアプリケーション 拡張機能要件書

本ドキュメントは、YaneuraOuエンジンの機能を参考に、現在の将棋Webアプリケーションに追加すべき機能要件をまとめたものです。

## 1. ゲームルール拡張機能

### 1.1. 特殊ルール対応
- **千日手判定**: 同一局面が4回出現した場合の引き分け判定機能
- **入玉宣言勝ち**: 24点法などに基づく入玉勝利判定機能
- **トライルール**: 自玉が相手玉の初期位置に到達した場合の勝利判定

### 1.2. 詰み探索機能
- 現在の局面から詰みまでの手順を探索・表示する機能
- 詰将棋モードの実装

## 2. 対局管理機能

### 2.1. 時間管理システム
- **持ち時間制**: 各プレイヤーの持ち時間管理
- **秒読み**: 持ち時間消費後の秒読み機能
- **フィッシャールール**: 1手ごとに時間が加算される方式への対応
- **時間無制限モード**: 練習・分析用の無制限対局

### 2.2. 対局モード
- **対人戦**: 現在実装済みのオンライン対戦機能の拡張
- **AI対戦**: WebAssemblyまたはWebWorkerを使用したAI対戦機能
- **観戦モード**: 他者の対局をリアルタイム観戦する機能
- **検討モード**: 対局後の棋譜を分析・検討する機能

## 3. 棋譜管理機能

### 3.1. 棋譜記録・再生
- **標準棋譜形式対応**: KIF, CSA, USI形式での棋譜保存・読み込み
- **分岐棋譜**: 変化手順の記録と管理
- **コメント機能**: 各手にコメントを付与する機能
- **局面評価値表示**: AI評価値の記録と表示

### 3.2. 棋譜データベース
- **棋譜保存機能**: ローカルストレージまたはクラウドへの棋譜保存
- **棋譜検索機能**: 日付、対戦相手、戦型などでの検索
- **棋譜共有機能**: URLやQRコードでの棋譜共有

## 4. 定跡機能

### 4.1. 定跡データベース
- **基本定跡表示**: 序盤の定跡手順の表示と選択
- **定跡編集機能**: ユーザーによる定跡の追加・編集
- **定跡学習モード**: 定跡を学習するためのトレーニング機能

### 4.2. 戦型判定
- 現在の局面の戦型を自動判定・表示する機能
- 戦型別の統計情報表示

## 5. 分析・学習支援機能

### 5.1. 候補手表示（MultiPV）
- 複数の有力な候補手とその評価値を表示
- 各候補手選択時の読み筋表示

### 5.2. 形勢判断
- リアルタイム形勢グラフ
- 評価値の数値表示
- 悪手・疑問手・好手の自動判定

### 5.3. ヒント機能
- 初心者向けの次の一手ヒント
- 危険な手の警告表示

## 6. UI/UX拡張機能

### 6.1. 表示オプション
- **座標表示**: 盤面の座標表示ON/OFF
- **最終手強調**: 直前の指し手をハイライト
- **利き表示**: 選択した駒の利きを可視化
- **王手表示**: 王手状態の視覚的強調

### 6.2. 操作性向上
- **手番表示**: 現在の手番を明確に表示
- **待った機能**: 指し手の取り消し（練習モード）
- **自動再生**: 棋譜の自動再生機能
- **速度調整**: 再生速度の調整

### 6.3. アクセシビリティ
- **音声読み上げ**: 指し手の音声読み上げ
- **効果音**: 駒を動かした時の効果音
- **色覚サポート**: 色覚特性に配慮した配色オプション

## 7. 統計・記録機能

### 7.1. 対局統計
- 勝率、平均手数、得意戦型などの統計表示
- レーティング計算・表示機能
- 対局履歴の詳細記録

### 7.2. 学習進捗
- 定跡習得率
- 詰将棋解答記録
- 日別・週別の対局数グラフ

## 8. 技術的要件

### 8.1. パフォーマンス
- WebWorkerを使用した並列処理（AI思考時）
- 効率的な局面管理（Zobristハッシュなど）
- 大量の棋譜データの効率的な処理

### 8.2. データ永続化
- IndexedDBを使用した大容量データ保存
- クラウド同期機能（オプション）
- エクスポート・インポート機能

### 8.3. 拡張性
- プラグインシステムの検討
- カスタムAIエンジンの追加機能
- テーマ・スキンのカスタマイズ

## 実装優先順位

### Phase 1（基本機能）
1. 時間管理システム（持ち時間、秒読み）
2. 棋譜保存・読み込み機能（KIF形式）
3. 千日手判定
4. 詰み探索表示

### Phase 2（分析機能）
1. 形勢判断・評価値表示
2. 候補手表示（MultiPV）
3. 検討モード
4. 基本定跡表示

### Phase 3（高度な機能）
1. AI対戦機能
2. 棋譜データベース
3. 統計・レーティング機能
4. 定跡編集・学習機能

## まとめ

これらの機能を段階的に実装することで、初心者から上級者まで幅広いユーザーに対応した、教育的価値の高い将棋Webアプリケーションを構築できます。特に、YaneuraOuの持つ「教育的な利用」という理念を引き継ぎ、学習支援機能を充実させることが重要です。
