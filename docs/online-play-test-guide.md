# 通信対戦機能テストガイド

## 概要
このドキュメントでは、将棋アプリの通信対戦機能をローカル環境でテストする手順を説明します。

## 前提条件
- Node.js がインストールされていること
- 2つのブラウザウィンドウ（またはタブ）を使用

## セットアップ

### 1. 開発サーバーの起動
```bash
cd packages/web
npm run dev
```

サーバーが起動したら、表示されたURL（通常 http://localhost:5173）を確認します。

### 2. ブラウザの準備
- 2つのブラウザウィンドウ（またはタブ）を開く
- 両方で http://localhost:5173 にアクセス
- 開発者ツールのコンソールを開いておく（デバッグ用）

## テスト手順

### 基本的な接続テスト

#### 1. ホスト側の操作
1. 「通信対戦」ボタンをクリック
2. 「部屋を作る」タブが選択されていることを確認
3. 「部屋を作成」ボタンをクリック
4. 接続情報（オファー）が表示されるのを待つ
5. 「オファーをコピー」ボタンをクリック

#### 2. ゲスト側の操作
1. 「通信対戦」ボタンをクリック
2. 「部屋に参加」タブを選択
3. ホストからコピーしたオファーを入力欄に貼り付け
4. 「部屋に参加」ボタンをクリック
5. 返答（アンサー）が生成されるのを待つ
6. 「アンサーをコピー」ボタンをクリック

#### 3. ホスト側での接続完了
1. ゲストからコピーしたアンサーを入力欄に貼り付け
2. 「接続を完了」ボタンをクリック
3. 「接続完了！」メッセージが表示されることを確認

#### 4. 接続確認
- 両方のブラウザで接続状態が「接続済み」になることを確認
- ホストが先手（黒）、ゲストが後手（白）になることを確認

### 対局機能のテスト

#### 1. 指し手の同期テスト
1. **ホスト側**：任意の駒を選択して移動
   - 例：7六歩（７七の歩を７六に移動）
2. **確認事項**：
   - ゲスト側の盤面に同じ手が反映される
   - 手番が白（ゲスト）に切り替わる
   - ホスト側では駒の選択ができなくなる

3. **ゲスト側**：任意の駒を選択して移動
   - 例：3四歩（３三の歩を３四に移動）
4. **確認事項**：
   - ホスト側の盤面に同じ手が反映される
   - 手番が黒（ホスト）に切り替わる

#### 2. 駒の成りテスト
1. 成れる状況を作る（例：角を敵陣に進める）
2. 成りダイアログが表示されることを確認
3. 「成る」を選択
4. 相手側でも成った駒が表示されることを確認

#### 3. 駒打ちテスト
1. 相手の駒を取る
2. 持ち駒から駒を選択
3. 盤面の任意の位置に打つ
4. 相手側でも駒打ちが反映されることを確認

#### 4. 投了テスト
1. いずれかのプレイヤーが「投了」ボタンをクリック
2. 両方のブラウザで勝敗が表示されることを確認

### エラーケースのテスト

#### 1. 不正な接続情報
- 無効なオファー/アンサーを入力した場合のエラー表示を確認

#### 2. 接続中の切断
1. 対局中にブラウザをリロード
2. 「切断されました」が表示されることを確認
3. 「接続をリセット」ボタンで再接続できることを確認

#### 3. 手番違いの操作
- 相手の手番中に駒を動かそうとしても動かないことを確認

## トラブルシューティング

### 接続できない場合
1. ブラウザのコンソールでエラーを確認
2. 両方のブラウザが同じ開発サーバー（http://localhost:5173）にアクセスしているか確認
3. ブラウザの拡張機能（特に広告ブロッカー）を無効化してみる

### 手が同期されない場合
1. コンソールでメッセージの送受信ログを確認
2. 接続状態が「接続済み」になっているか確認

## デバッグ情報
コンソールには以下の情報が出力されます：
- WebRTC接続状態の変化
- メッセージの送受信ログ
- エラー情報

## 次のステップ
基本的な通信対戦機能のテストが完了したら：
1. GitHub Pages にデプロイしてインターネット経由でのテスト
2. 異なるネットワーク間での接続テスト
3. パフォーマンステスト（長時間の対局）