# P2P デモの動作確認方法

## 概要

2つのP2Pデモを実装しました：

1. **libp2p デモ** (`p2p-demo.html`) - libp2pを使用したP2P実装
2. **WebRTC デモ** (`webrtc-demo.html`) - 純粋なWebRTCを使用した真のサーバーレスP2P実装

## WebRTC デモの使用方法（推奨）

WebRTCデモは、シグナリングサーバーを一切使用しない真のサーバーレスP2P実装です。

### 手順

1. **開発サーバーを起動**
   ```bash
   npm run dev
   ```

2. **2つのブラウザウィンドウを開く**
   - ブラウザ1: http://localhost:5173/webrtc-demo.html
   - ブラウザ2: http://localhost:5173/webrtc-demo.html （別のタブまたは別のブラウザ）

3. **ホスト側（ブラウザ1）の操作**
   - 「ホストとして開始」ボタンをクリック
   - オファーが生成されるのを待つ
   - 「オファーをコピー」ボタンをクリック

4. **ゲスト側（ブラウザ2）の操作**
   - 「ゲストとして開始」ボタンをクリック
   - ホストからコピーしたオファーを貼り付け
   - 「オファーを受け入れる」ボタンをクリック
   - アンサーが生成されるのを待つ
   - 「アンサーをコピー」ボタンをクリック

5. **ホスト側（ブラウザ1）に戻る**
   - ゲストからコピーしたアンサーを貼り付け
   - 「アンサーを受け入れる」ボタンをクリック

6. **接続確立**
   - 両方のブラウザで「接続済み」と表示される
   - チャット機能が有効になる
   - メッセージを送受信できる

### 特徴

- **完全にサーバーレス**: シグナリングサーバー不要
- **手動でのSDP交換**: オファー/アンサーをコピー＆ペーストで交換
- **STUNサーバー使用**: GoogleのパブリックSTUNサーバーを使用してNAT越え
- **リアルタイムチャット**: WebRTCデータチャネルを使用

## libp2p デモの使用方法

libp2pデモは、より高度なP2P機能を提供しますが、現在の実装ではブートストラップノードが必要です。

### 手順

1. **開発サーバーを起動**
   ```bash
   npm run dev
   ```

2. **ブラウザを開く**
   - http://localhost:5173/p2p-demo.html

3. **P2Pノードを開始**
   - 「P2Pノードを開始」ボタンをクリック
   - Peer IDとリスニングアドレスが表示される

### 制限事項

- 現在の実装では、ブラウザ環境でリッスンできないため、他のピアとの接続にはWebSocketサーバーまたはリレーノードが必要
- 真のサーバーレスP2Pを実現するには、WebRTCトランスポートの統合が必要

## トラブルシューティング

### 接続が確立されない場合

1. **ブラウザのコンソールを確認**
   - F12キーでデベロッパーツールを開く
   - Consoleタブでエラーメッセージを確認

2. **ファイアウォール/アンチウイルス**
   - WebRTC接続がブロックされていないか確認

3. **異なるネットワーク間での接続**
   - STUNサーバーがNAT越えを支援しますが、厳格なファイアウォール環境では接続できない場合があります
   - その場合はTURNサーバーが必要（現在未実装）

### メッセージが送信されない場合

- データチャネルが開いているか確認（「接続済み」と表示されている必要があります）
- ブラウザコンソールでエラーを確認

## 技術詳細

### WebRTC実装
- 標準的なWebRTC APIを使用
- STUNサーバー: stun.l.google.com:19302
- データチャネル名: "game"
- SDPはbase64エンコードされたJSON形式

### libp2p実装
- libp2p v0.54を使用
- プロトコル: Gossipsub, Kademlia DHT, Identify
- トランスポート: WebSocket（WebRTCは統合準備中）

## 今後の改善案

1. **QRコード生成**: オファー/アンサーをQRコードで表示し、モバイルデバイス間での交換を簡単に
2. **クリップボード API**: 自動的にクリップボードにコピー/ペースト
3. **TURNサーバー統合**: より確実なNAT越え
4. **ファイル転送**: チャットだけでなくファイル転送機能
5. **複数ピア対応**: 3人以上での通信